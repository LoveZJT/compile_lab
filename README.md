# 2.语法分析与词法分析
>本章实验为实验一,任务是编写一个程序对使用C语言书写的源代码进行词法分析和语法分析(C语言的文法参见附录A),并打印分析结果。实验要求使用词法分析工具GNUFlex和语法分析工具GNU Bison,并使用C语言来完成。在两个强大工具的帮助下,编写一个能进行词法分析和语法分析的程序是一件相当轻松愉快的事情。需要注意的是,由于在后面的实验中还会用到本次实验已经写好的代码,因此保持一个良好的代码风格、系统地设计代码结构和各模块之间的接口对于整个实验来讲相当重要。

## 2.1 实验内容
### 2.1.1 实验要求
>你的程序要能够查出C--源代码中可能包含的下述几类错误:

>>1) 词法错误(错误类型A):即出现C--词法中未定义的字符以及任何不符合C--词法单元定义的字符;

>>2) 语法错误(错误类型B)。

> 除此之外,你的程序可以选择完成以下部分或全部的要求:

>>1) 要求1.1:识别八进制数和十六进制数。若输入文件中包含符合词法定义的八进制数
(如0123)和十六进制数(如0x3F),你的程序需要得出相应的词法单元;若输入文
件中包含不符合词法定义的八进制数(如09)和十六进制数(如0x1G),你的程序需
要给出输入文件有词法错误(即错误类型A)的提示信息。八进制数和十六进制数的定
义参见附录A。
>>2) 要求1.2:识别指数形式的浮点数。若输入文件中包含符合词法定义的指数形式的浮点
数(如1.05e-4),你的程序需要得出相应的词法单元;若输入文件中包含不符合词法
定义的指数形式的浮点数(如1.05e),你的程序需要给出输入文件有词法错误(即错
误类型A)的提示信息。指数形式的浮点数的定义参见附录A。
>>3) 要求1.3:识别“//”和“/*...*/”形式的注释。若输入文件中包含符合定义的“//”和
“/*...*/”形式的注释,你的程序需要能够滤除这样的注释;若输入文件中包含不符合
定义的注释(如“/*...*/”注释中缺少“/*”),你的程序需要给出由不符合定义的注
释所引发的错误的提示信息。注释的定义参见附录A。

>你的程序在输出错误提示信息时,需要输出具体的错误类型、出错的位置(源程序行号)
以及相关的说明文字。
### 2.1.2 输入格式
>你的程序的输入是一个包含C源代码的文本文件,程序需要能够接收一个输入文件名作
为参数。例如,假设你的程序名为cc、输入文件名为test1、程序和输入文件都位于当前目录
下,那么在Linux命令行下运行./cc test1即可获得以test1作为输入文件的输出结果。
### 2.1.3 输出格式
>实验一要求通过标准输出打印程序的运行结果。对于那些包含词法或者语法错误的输入文
件,只要输出相关的词法或语法有误的信息即可。在这种情况下,注意不要输出任何与语法树
有关的内容。要求输出的信息包括错误类型、出错的行号以及说明文字,其格式为:

      Error type [错误类型] at Line [行号]: [说明文字].
    
>说明文字的内容没有具体要求,但是错误类型和出错的行号一定要正确,因为这是判断输
出的错误提示信息是否正确的唯一标准。请严格遵守实验要求中给定的错误分类(即词法错误
为错误类型A,语法错误为错误类型B),否则将影响你的实验评分。注意,输入文件中可能
会包含一个或者多个错误(但输入文件的同一行中保证不出现多个错误),你的程序需要将这
些错误全部报告出来,每一条错误提示信息在输出中单独占一行。
>对于那些没有任何词法或语法错误的输入文件,你的程序需要将构造好的语法树按照先序
遍历的方式打印每一个结点的信息,这些信息包括:
>>1) 如果当前结点是一个语法单元并且该语法单元没有产生&epsilon;,则打印该语法单元的名称以
及它在输入文件中的行号(行号被括号所包围,并且与语法单元名之间有一个空
格)。所谓某个语法单元在输入文件中的行号是指该语法单元产生出的所有词素中的
第一个在输入文件中出现的行号。
>>2) 如果当前结点是一个语法单元并且该语法单元产生了&epsilon;,则无需打印该语法单元的信
息。
>>3) 如果当前结点是一个词法单元,则只要打印该词法单元的名称,而无需打印该词法单
元的行号。
>>>a) 如果当前结点是词法单元ID,则要求额外打印该标识符所对应的词素;
>>>b) 如果当前结点是词法单元TYPE,则要求额外打印说明以该类型为int还是float;
>>>c) 如果当前结点是词法单元INT或者FLOAT,则要求以十进制的形式额外打印该数字
所对应的数值;
>>>d) 词法单元所额外打印的信息与词法单元名之间以一个冒号和一个空格隔开。

>每一条词法或语法单元的信息单独占一行,而每个子结点的信息相对于其父结点的信息来
说,在行首都要求缩进2个空格。具体输出格式可参见后续的样例。
### 2.1.4 测试环境
你的程序将在如下环境中被编译并运行:
>1) GNU Linux Release: Ubuntu 12.04, kernel version 3.2.0-29;
>2) GCC version 4.6.3;
>3) GNU Flex version 2.5.35;
>4) GNU Bison version 2.5。

一般而言,只要避免使用过于冷门的特性,使用其它版本的Linux或者GCC等,也基本上不
会出现兼容性方面的问题。注意,实验一的检查过程中不会去安装或尝试引用各类方便编程的
函数库(如glib等),因此请不要在你的程序中使用它们。
